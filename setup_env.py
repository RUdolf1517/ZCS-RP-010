#!/usr/bin/env python3
"""
–°–∫—Ä–∏–ø—Ç –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
"""

import os
import secrets

def generate_secret_key():
    """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω—ã–π —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á."""
    return secrets.token_hex(32)

def setup_env():
    """–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç .env —Ñ–∞–π–ª."""
    print("üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è ZCS-RP-010")
    print()

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —É–∂–µ .env
    if os.path.exists('.env'):
        response = input(".env —Ñ–∞–π–ª —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç. –ü–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç—å? (y/N): ")
        if response.lower() != 'y':
            print("–û—Ç–º–µ–Ω–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏.")
            return

    print("–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π...")

    # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á
    secret_key = generate_secret_key()

    # –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    print()
    print("=== –ù–ê–°–¢–†–û–ô–ö–ò –°–ï–†–í–ï–†–ê ===")
    host = input("–•–æ—Å—Ç —Å–µ—Ä–≤–µ—Ä–∞ (0.0.0.0): ").strip() or "0.0.0.0"
    port = input("–ü–æ—Ä—Ç —Å–µ—Ä–≤–µ—Ä–∞ (5001): ").strip() or "5001"
    debug = input("–†–µ–∂–∏–º –æ—Ç–ª–∞–¥–∫–∏ (True): ").strip().lower()
    debug = "True" if debug in ('', 'true', 'yes', 'y') else "False"

    print()
    print("=== –ù–ê–°–¢–†–û–ô–ö–ò –ê–î–ú–ò–ù–ò–°–¢–†–ê–¢–û–†–ê ===")
    admin_username = input("–õ–æ–≥–∏–Ω –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ (admin): ").strip() or "admin"

    while True:
        admin_password = input("–ü–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ (–º–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤): ").strip()
        if len(admin_password) >= 8:
            break
        print("–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤!")

    print()
    print("=== –ì–ï–ù–ï–†–ê–¶–ò–Ø –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–ò ===")

    # –°–æ–∑–¥–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ .env —Ñ–∞–π–ª–∞
    env_content = f"""# –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è ZCS-RP-010
# –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫—Ä–∏–ø—Ç–æ–º setup_env.py

# === –ù–ê–°–¢–†–û–ô–ö–ò –°–ï–†–í–ï–†–ê ===
FLASK_HOST={host}
FLASK_PORT={port}
FLASK_DEBUG={debug}

# === –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨ ===
FLASK_SECRET_KEY={secret_key}

# === –ê–î–ú–ò–ù–ò–°–¢–†–ê–¢–û–† ===
ADMIN_USERNAME={admin_username}
ADMIN_PASSWORD={admin_password}

# === –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –ù–ê–°–¢–†–û–ô–ö–ò ===
# LOG_LEVEL=INFO
"""

    # –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –≤ —Ñ–∞–π–ª
    with open('.env', 'w', encoding='utf-8') as f:
        f.write(env_content)

    print("‚úÖ –§–∞–π–ª .env —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!")
    print()
    print("üìã –°–æ–¥–µ—Ä–∂–∏–º–æ–µ .env —Ñ–∞–π–ª–∞:")
    print("-" * 50)
    print(env_content)
    print("-" * 50)
    print()
    print("‚ö†Ô∏è  –í–ê–ñ–ù–û:")
    print("- –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —ç—Ç–æ—Ç —Ñ–∞–π–ª –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ–º –º–µ—Å—Ç–µ")
    print("- –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∫–æ–º–º–∏—Ç—å—Ç–µ .env –≤ git")
    print("- –ò–∑–º–µ–Ω–∏—Ç–µ –ø–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏")
    print()
    print("üöÄ –¢–µ–ø–µ—Ä—å –º–æ–∂–µ—Ç–µ –∑–∞–ø—É—Å–∫–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:")
    print("python app.py")

if __name__ == "__main__":
    try:
        setup_env()
    except KeyboardInterrupt:
        print("\n–û—Ç–º–µ–Ω–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏.")
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞: {e}")