{% extends 'base.html' %}
{% block title %}Новая карточка ученика{% endblock %}
{% block content %}
<div class="form-page">
  <div class="form-container">
    <div class="form-card">
      <div class="form-card__body">
        <h1 class="form-title">{% if student %}Редактирование карточки{% else %}Новая карточка ученика{% endif %}</h1>

        {% if error_message %}
          <div class="alert error">{{ error_message }}</div>
        {% endif %}

        <form method="post" class="form-grid">
          <div class="form-group">
            <label class="form-label">ФИО *</label>
            <input type="text" name="full_name" class="form-input" value="{{ student.full_name if student }}" required>
          </div>
          <div class="form-group">
            <label class="form-label">Класс *</label>
            <input type="text" name="class_name" class="form-input" placeholder="7А" value="{{ student.class_name if student }}" required>
          </div>
          <div class="form-group">
            <label class="form-label">Кл. руководитель *</label>
            <input type="text" name="class_teacher" class="form-input" value="{{ student.class_teacher if student }}" required>
          </div>
          <div class="form-group form-group--full">
            <label class="form-label">Достижения</label>
            {% set ach_lines = (student.achievements.split('\n') if student and student.achievements else []) %}
            <div id="achievements-list">
              {% if ach_lines and ach_lines|length > 0 %}
                {% for line in ach_lines %}
                  <div class="d-flex gap-2 mb-2 achievement-item">
                    <input type="text" name="achievements[]" class="form-input flex-grow-1" placeholder="Например: Победитель олимпиады…" value="{{ line }}">
                    <button type="button" class="btn btn-outline-danger btn-sm" onclick="removeAchievement(this)">Удалить</button>
                  </div>
                {% endfor %}
              {% else %}
                  <div class="d-flex gap-2 mb-2 achievement-item">
                    <input type="text" name="achievements[]" class="form-input flex-grow-1" placeholder="Например: Победитель олимпиады…">
                    <button type="button" class="btn btn-outline-danger btn-sm" onclick="removeAchievement(this)">Удалить</button>
                  </div>
              {% endif %}
            </div>
            <button type="button" class="btn btn-outline-primary btn-sm" onclick="addAchievement()">Добавить достижение</button>
          </div>
          <script>
          function addAchievement() {
            const container = document.getElementById('achievements-list');
            const item = document.createElement('div');
            item.className = 'd-flex gap-2 mb-2 achievement-item';
            item.innerHTML = '<input type="text" name="achievements[]" class="form-input flex-grow-1" placeholder="Например: Победитель олимпиады…">' +
                             '<button type="button" class="btn btn-outline-danger btn-sm" onclick="removeAchievement(this)">Удалить</button>';
            container.appendChild(item);
          }
          function removeAchievement(btn) {
            const item = btn.closest('.achievement-item');
            const container = document.getElementById('achievements-list');
            if (container.children.length > 1) {
              item.remove();
            } else {
              item.querySelector('input').value = '';
            }
          }
          </script>
          <div class="form-actions">
            <button class="btn btn-primary" type="submit">Сохранить</button>
            <a class="btn btn-secondary" href="{{ url_for('admin_dashboard') }}">Отмена</a>
            {% if student %}
              <button class="btn btn-danger" formmethod="post" formaction="{{ url_for('admin_student_delete', student_id=student.id) }}" onclick="return confirm('Удалить карточку {{ student.full_name }}?');">Удалить</button>
            {% endif %}
          </div>
        </form>
      </div>
    </div>
  </div>
 </div>
{% endblock %}


